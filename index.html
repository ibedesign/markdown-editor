<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚¨ãƒ‡ã‚£ã‚¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
        }

        .toolbar {
            display: flex;
            gap: 4px;
            padding: 12px;
            background: #fafafa;
            border-bottom: 1px solid #e0e0e0;
            flex-wrap: wrap;
            position: relative;
        }

        .content-wrapper {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-left: 1px solid #e0e0e0;
        }

        .preview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 16px;
            background: white;
            position: relative;
        }

        .toolbar button {
            padding: 8px 12px;
            border: 1px solid #d0d0d0;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .toolbar button:hover {
            background: #f0f0f0;
            border-color: #999;
        }

        .toolbar button:active {
            background: #e0e0e0;
        }

        #editor {
            flex: 1;
            width: 100%;
            border: none;
            border-bottom: 1px solid #d0d0d0;
            padding: 16px;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 0;
        }

        #editor:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .preview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            position: relative;
            padding: 16px;
            gap: 16px;
        }

        .title-area {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .title-area label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }

        #titlePreview {
            width: 100%;
            height: 60px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            padding: 12px;
            padding-right: 120px;
            font-size: 16px;
            line-height: 1.4;
            resize: none;
            font-family: 'Segoe UI', sans-serif;
            background: #f9f9f9;
            user-select: all;
        }

        #titlePreview:focus {
            outline: none;
            border-color: #2196F3;
        }

        .title-area .copy-button {
            position: absolute;
            top: 32px;
            right: 8px;
            padding: 6px 12px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
        }

        .title-area .copy-button:hover {
            background: #1976D2;
        }

        .title-area .copy-button.copied {
            background: #4CAF50;
        }

        .html-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .html-area label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .html-area .copy-button {
            position: absolute;
            top: 32px;
            right: 8px;
            padding: 6px 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
        }

        .html-area .copy-button:hover {
            background: #45a049;
        }

        .html-area .copy-button.copied {
            background: #2196F3;
        }

        #htmlPreview {
            flex: 1;
            width: 100%;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            padding: 16px;
            padding-right: 120px;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            font-family: 'Consolas', 'Monaco', monospace;
            background: #fafafa;
            user-select: all;
        }

        #htmlPreview:focus {
            outline: none;
            border-color: #2196F3;
        }

        .guide-toggle {
            position: absolute;
            top: 12px;
            right: 20px;
            padding: 8px 16px;
            background: #e3f2fd;
            color: #1976D2;
            border: 2px solid #2196F3;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 13px;
            font-weight: bold;
            z-index: 1000;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .guide-toggle:hover {
            background: #bbdefb;
            border-color: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .guide-toggle::before {
            content: 'ğŸ”°';
            font-size: 16px;
        }

        .guide-section {
            position: fixed;
            top: 0;
            right: 0;
            width: 625px;
            height: 100vh;
            background: white;
            border-left: 1px solid #e0e0e0;
            box-shadow: -4px 0 20px rgba(0,0,0,0.2);
            padding: 30px;
            padding-bottom: 50px;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .guide-section.active {
            transform: translateX(0);
        }

        .guide-section h2 {
            color: #333;
            font-size: 24px;
            margin-bottom: 20px;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }

        .guide-section h3 {
            color: #2196F3;
            font-size: 18px;
            margin-top: 25px;
            margin-bottom: 12px;
            font-weight: bold;
        }

        .guide-section p {
            color: #555;
            font-size: 14px;
            line-height: 1.8;
            margin: 8px 0;
            margin-left: 10px;
        }

        .guide-section code {
            background: #f0f0f0;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            color: #d63384;
        }

        .guide-section ul {
            margin: 10px 0;
            padding-left: 25px;
        }

        .guide-section li {
            color: #666;
            margin: 5px 0;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .guide-section {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <button onclick="applyFormat('h1')" title="è¦‹å‡ºã—1">H1</button>
        <button onclick="applyFormat('h2')" title="è¦‹å‡ºã—2">H2</button>
        <button onclick="applyFormat('h3')" title="è¦‹å‡ºã—3">H3</button>
        <button onclick="applyFormat('bold')" title="å¤ªå­—"><strong>B</strong></button>
        <button onclick="applyFormat('ul')" title="ç®‡æ¡æ›¸ã">â€¢</button>
        <button onclick="applyFormat('ol')" title="ç•ªå·ä»˜ããƒªã‚¹ãƒˆ">1.</button>
        <button onclick="applyFormat('caption')" title="ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³">ï¼ˆC</button>
        <button onclick="applyFormat('alt')" title="ALT">ï¼ˆALT</button>
        <button onclick="applyFormat('image')" title="ç”»åƒ">ç”»åƒ</button>
        <button onclick="applyFormat('paragraph')" title="æ®µè½">P</button>
        <button onclick="insertHR()" title="æ°´å¹³ç·š">---</button>
        <button onclick="deleteLine()" title="å‰Šé™¤" style="color: #d32f2f;">å‰Šé™¤</button>
        <button onclick="insertLineBreak()" title="æ”¹è¡Œ">æ”¹è¡Œ</button>
        <button onclick="resetAll()" title="ãƒªã‚»ãƒƒãƒˆ">ãƒªã‚»ãƒƒãƒˆ</button>
        <button class="guide-toggle" onclick="toggleGuide()">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</button>
    </div>
    
    <div class="content-wrapper">
        <div class="preview-container">
            <div class="title-area">
                <label>ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆH1ã‚’å…¥åŠ›ã™ã‚‹ã¨è‡ªå‹•ã§è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</label>
                <textarea id="titlePreview" readonly placeholder="H1è¦‹å‡ºã—ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™..."></textarea>
                <button class="copy-button" onclick="copyTitle(event)">ã‚³ãƒ”ãƒ¼</button>
            </div>
            <div class="html-area">
                <label>HTMLã‚³ãƒ¼ãƒ‰</label>
                <textarea id="htmlPreview" readonly placeholder="HTMLã‚³ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™..."></textarea>
                <button class="copy-button" onclick="copyHTML(event)">ã‚³ãƒ”ãƒ¼</button>
            </div>
        </div>
        <div class="editor-container">
            <textarea id="editor" placeholder="ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
        </div>
    </div>

    <div class="guide-section" id="guideSection">
        <h2>ğŸ“– ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2>
        
        <h3>ğŸ’¡ åŸºæœ¬ã®ä½¿ã„æ–¹</h3>
        <p>1. å·¦å´ã®ã‚¨ãƒ‡ã‚£ã‚¿ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›</p>
        <p>2. ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒœã‚¿ãƒ³ã§æ›¸å¼ã‚’é©ç”¨ï¼ˆãƒ†ã‚­ã‚¹ãƒˆé¸æŠ or ã‚«ãƒ¼ã‚½ãƒ«ã‚’è¡Œã«é…ç½®ï¼‰</p>
        <p>3. å³å´ã®ä¸Šéƒ¨ã«H1ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã€ä¸‹éƒ¨ã«HTMLã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™</p>
        <p>4. ãã‚Œãã‚Œã®ã€Œã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</p>
        <p>5. ã€Œãƒªã‚»ãƒƒãƒˆã€ãƒœã‚¿ãƒ³ã§ã™ã¹ã¦ã‚¯ãƒªã‚¢</p>

        <h3>ğŸ› ï¸ ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®æ©Ÿèƒ½</h3>
        <p><strong>H1, H2, H3:</strong> è¦‹å‡ºã—ã‚’é©ç”¨ï¼ˆã‚«ãƒ¼ã‚½ãƒ«ãŒã‚ã‚‹è¡Œå…¨ä½“ã«é©ç”¨ã•ã‚Œã¾ã™ï¼‰</p>
        <p>ã€€â€» H1ã‚’ä½¿ã†ã¨å³ä¸Šã®ã‚¿ã‚¤ãƒˆãƒ«ã‚¨ãƒªã‚¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆHTMLå‡ºåŠ›ã«ã¯å«ã¾ã‚Œã¾ã›ã‚“ï¼‰</p>
        <p>ã€€â€» åŒã˜è¡Œã§åˆ¥ã®è¦‹å‡ºã—ã‚’é©ç”¨ã™ã‚‹ã¨ã€æ—¢å­˜ã® # è¨˜å·ã‚’è‡ªå‹•å‰Šé™¤ã—ã¾ã™</p>
        <p><strong>B:</strong> å¤ªå­—ã‚’é©ç”¨ï¼ˆé¸æŠãƒ†ã‚­ã‚¹ãƒˆã‚’ <code>**</code> ã§å›²ã¿ã¾ã™ï¼‰</p>
        <p><strong>â€¢ (ç®‡æ¡æ›¸ã):</strong> ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆã‚’ä½œæˆï¼ˆè¡Œé ­ã« <code>-</code> ã‚’è¿½åŠ ï¼‰</p>
        <p><strong>1. (ç•ªå·ä»˜ã):</strong> ç•ªå·ä»˜ããƒªã‚¹ãƒˆã‚’ä½œæˆï¼ˆè¡Œé ­ã« <code>1. 2. 3...</code> ã‚’è¿½åŠ ï¼‰</p>
        <p><strong>ï¼ˆC:</strong> ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³è¨˜å·ã‚’è¿½åŠ 
            <br>ã€€- ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹è¡Œï¼šæœ«å°¾ã« <code>ï¼ˆC</code> ã‚’è¿½åŠ  â†’ å¤‰æ›å¾Œã¯ <code>&lt;p&gt;ãƒ†ã‚­ã‚¹ãƒˆ&lt;/p&gt;</code>
            <br>ã€€- ç©ºç™½è¡Œï¼š<code>ï¼ˆC</code> ã‚’æŒ¿å…¥ â†’ å¤‰æ›å¾Œã¯ <code>&lt;p&gt;â˜…&lt;/p&gt;</code>
            <br>ã€€â€» ç”»åƒã®ä¸‹ã«Pã‚¿ã‚°ãŒã‚ã‚‹ã¨è‡ªå‹•ã§ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã«ãªã‚‹ä»•çµ„ã¿ã«å¯¾å¿œã—ã¦ã„ã¾ã™
        </p>
        <p><strong>ç”»åƒ:</strong> <code>â˜…ç”»åƒ</code> ãƒãƒ¼ã‚«ãƒ¼ã‚’æŒ¿å…¥ï¼ˆå¤‰æ›å¾Œã‚‚ãã®ã¾ã¾ <code>â˜…ç”»åƒ</code>ï¼‰</p>
        <p><strong>P:</strong> é¸æŠã—ãŸè¡Œã‚’æ®µè½ã¨ã—ã¦æ‰±ã†ï¼ˆå‰å¾Œã«ç©ºè¡Œã‚’è¿½åŠ ã—ã¦ <code>&lt;p&gt;</code> ã‚¿ã‚°ã§å›²ã‚€ï¼‰</p>
        <p><strong>--- (æ°´å¹³ç·š):</strong> æ°´å¹³ç·š <code>---</code> ã‚’æŒ¿å…¥ï¼ˆå¤‰æ›å¾Œã¯ <code>&lt;hr&gt;</code>ï¼‰</p>
        <p><strong>å‰Šé™¤:</strong> é¸æŠãƒ†ã‚­ã‚¹ãƒˆ or ã‚«ãƒ¼ã‚½ãƒ«ãŒã‚ã‚‹è¡Œã‚’å‰Šé™¤</p>
        <p><strong>æ”¹è¡Œ:</strong> ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã«æ”¹è¡Œã‚’æŒ¿å…¥</p>
        <p><strong>ãƒªã‚»ãƒƒãƒˆ:</strong> å·¦å´ã®ã‚¨ãƒ‡ã‚£ã‚¿ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢</p>

        <h3>ğŸ“º YouTubeå¯¾å¿œ</h3>
        <p>YouTubeã®URLã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã‚‹ã¨è‡ªå‹•çš„ã«åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã•ã‚Œã¾ã™</p>
        <p>ä¾‹: <code>https://www.youtube.com/watch?v=VIDEO_ID</code> ã¾ãŸã¯ <code>https://youtu.be/VIDEO_ID</code></p>

        <h3>ğŸ”— URLè‡ªå‹•ãƒªãƒ³ã‚¯</h3>
        <p>YouTubeä»¥å¤–ã®URLã¯è‡ªå‹•çš„ã«ãƒªãƒ³ã‚¯ã‚¿ã‚°ï¼ˆ<code>&lt;a&gt;</code>ï¼‰ã«å¤‰æ›ã•ã‚Œã¾ã™</p>
        <p>URLå˜ç‹¬ã®è¡Œã¯åˆ¥æ®µè½ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã¾ã™</p>

        <h3>ğŸ–¼ï¸ ç”»åƒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼</h3>
        <p><code>â˜…ç”»åƒ</code> ã¨å…¥åŠ›ã™ã‚‹ã¨ã€ãã®ã¾ã¾ã®å½¢ã§å‡ºåŠ›ã•ã‚Œã¾ã™ï¼ˆWordPressç”¨ï¼‰</p>
        <p>pã‚¿ã‚°ã§å›²ã¾ã‚Œãšã€ç›´å‰ã®ãƒ†ã‚­ã‚¹ãƒˆã¨ã®é–“ã«æ”¹è¡Œã‚‚å…¥ã‚Šã¾ã›ã‚“</p>

        <h3>ğŸ“ ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³è¨˜æ³•</h3>
        <p>è¡Œæœ«ãŒ <code>ï¼ˆc</code> ã¾ãŸã¯ <code>ï¼ˆC</code> ã®å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›ã•ã‚Œã¾ã™ï¼š</p>
        <p>ã€€- <code>ãƒ†ã‚­ã‚¹ãƒˆï¼ˆC</code> â†’ <code>&lt;p&gt;ãƒ†ã‚­ã‚¹ãƒˆ&lt;/p&gt;</code></p>
        <p>ã€€- <code>ï¼ˆC</code> ã®ã¿ â†’ <code>&lt;p&gt;â˜…&lt;/p&gt;</code></p>
        <p>â€» WordPressã§ç”»åƒã®ä¸‹ã«Pã‚¿ã‚°ãŒã‚ã‚‹ã¨è‡ªå‹•ã§ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã«ãªã‚‹ä»•çµ„ã¿ã«å¯¾å¿œ</p>

        <h3>ğŸ“ æ°´å¹³ç·š</h3>
        <p><code>---</code> ã§æ°´å¹³ç·šï¼ˆ<code>&lt;hr&gt;</code>ï¼‰ãŒæŒ¿å…¥ã•ã‚Œã¾ã™</p>

        <h3>âœï¸ æ”¹è¡Œã¨Pã‚¿ã‚°</h3>
        <p>å˜ä¸€æ”¹è¡Œã¯ <code>&lt;br&gt;</code> ã‚¿ã‚°ã«å¤‰æ›ã•ã‚Œã€æ™®é€šã®ãƒ†ã‚­ã‚¹ãƒˆã¯ <code>&lt;p&gt;</code> ã‚¿ã‚°ã§å›²ã¾ã‚Œã¾ã™</p>
        <p>ç©ºè¡Œã§æ®µè½ãŒåŒºåˆ‡ã‚‰ã‚Œã¾ã™</p>

        <h3>ğŸ“ ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ã®ä¾‹</h3>
        <p><strong>è¦‹å‡ºã—:</strong></p>
        <p><code># è¦‹å‡ºã—1</code> â†’ ã‚¿ã‚¤ãƒˆãƒ«ã‚¨ãƒªã‚¢ã«è¡¨ç¤ºï¼ˆHTMLå‡ºåŠ›ã«ã¯å«ã¾ã‚Œã¾ã›ã‚“ï¼‰</p>
        <p><code>## è¦‹å‡ºã—2</code> â†’ <code>&lt;h2&gt;è¦‹å‡ºã—2&lt;/h2&gt;</code></p>
        <p><code>### è¦‹å‡ºã—3</code> â†’ <code>&lt;h3&gt;è¦‹å‡ºã—3&lt;/h3&gt;</code></p>

        <p><strong>å¤ªå­—:</strong></p>
        <p><code>**å¤ªå­—**</code> â†’ <code>&lt;strong&gt;å¤ªå­—&lt;/strong&gt;</code></p>

        <p><strong>ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆ:</strong></p>
        <p><code>- é …ç›®1</code><br><code>- é …ç›®2</code> â†’ <code>&lt;ul&gt;&lt;li&gt;é …ç›®1&lt;/li&gt;&lt;li&gt;é …ç›®2&lt;/li&gt;&lt;/ul&gt;</code></p>

        <p><strong>ç•ªå·ä»˜ããƒªã‚¹ãƒˆ:</strong></p>
        <p><code>1. é …ç›®1</code><br><code>2. é …ç›®2</code> â†’ <code>&lt;ol&gt;&lt;li&gt;é …ç›®1&lt;/li&gt;&lt;li&gt;é …ç›®2&lt;/li&gt;&lt;/ol&gt;</code></p>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const htmlPreview = document.getElementById('htmlPreview');
        const titlePreview = document.getElementById('titlePreview');

        // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å…¥åŠ›ã‚’ç›£è¦–
        editor.addEventListener('input', updatePreview);

        function applyFormat(format) {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            
            // ç”»åƒãƒœã‚¿ãƒ³ã®å ´åˆã¯ç›´å‰ã«æ”¹è¡Œã‚’å…¥ã‚Œã¦æŒ¿å…¥
            if (format === 'image') {
                const beforeText = editor.value.substring(0, start);
                const afterText = editor.value.substring(end);
                // ç›´å‰ã«æ”¹è¡Œã‚’è¿½åŠ ï¼ˆãŸã ã—å…ˆé ­ã®å ´åˆã¯ä¸è¦ï¼‰
                const prefix = beforeText.length > 0 && !beforeText.endsWith('\n') ? '\n' : '';
                editor.value = beforeText + prefix + 'â˜…ç”»åƒ' + afterText;
                const newPosition = start + prefix.length + 3;
                editor.setSelectionRange(newPosition, newPosition);
                editor.focus();
                updatePreview();
                return;
            }
            
            let selectedText = editor.value.substring(start, end);
            let realStart = start;
            let realEnd = end;
            
            // ãƒ†ã‚­ã‚¹ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã€ã‚«ãƒ¼ã‚½ãƒ«ãŒã‚ã‚‹è¡Œå…¨ä½“ã‚’å–å¾—
            if (start === end) {
                const text = editor.value;
                let lineStart = start;
                let lineEnd = end;
                
                // è¡Œã®é–‹å§‹ä½ç½®ã‚’æ¢ã™
                while (lineStart > 0 && text[lineStart - 1] !== '\n') {
                    lineStart--;
                }
                
                // è¡Œã®çµ‚äº†ä½ç½®ã‚’æ¢ã™
                while (lineEnd < text.length && text[lineEnd] !== '\n') {
                    lineEnd++;
                }
                
                selectedText = text.substring(lineStart, lineEnd);
                realStart = lineStart;
                realEnd = lineEnd;
            }
            
            if (!selectedText.trim() && format !== 'caption' && format !== 'alt') {
                alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã™ã‚‹ã‹ã€ã‚«ãƒ¼ã‚½ãƒ«ã‚’è¡Œã«é…ç½®ã—ã¦ãã ã•ã„');
                return;
            }

            let newText = '';
            const beforeText = editor.value.substring(0, realStart);
            const afterText = editor.value.substring(realEnd);

            switch(format) {
                case 'h1':
                    // æ—¢å­˜ã®è¦‹å‡ºã—è¨˜å·ã‚’å‰Šé™¤
                    newText = '# ' + selectedText.replace(/^#{1,3}\s*/, '');
                    break;
                case 'h2':
                    // æ—¢å­˜ã®è¦‹å‡ºã—è¨˜å·ã‚’å‰Šé™¤
                    newText = '## ' + selectedText.replace(/^#{1,3}\s*/, '');
                    break;
                case 'h3':
                    // æ—¢å­˜ã®è¦‹å‡ºã—è¨˜å·ã‚’å‰Šé™¤
                    newText = '### ' + selectedText.replace(/^#{1,3}\s*/, '');
                    break;
                case 'bold':
                    newText = '**' + selectedText + '**';
                    break;
                case 'ul':
                    newText = selectedText.split('\n').map(line => line.trim() ? '- ' + line.trim() : line).join('\n');
                    break;
                case 'ol':
                    newText = selectedText.split('\n').map((line, i) => line.trim() ? `${i + 1}. ${line.trim()}` : line).join('\n');
                    break;
                case 'caption':
                    // ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¯ç›´å‰ã«æ”¹è¡Œã‚’å…¥ã‚Œã‚‹
                    const needsPrefix = realStart > 0 && editor.value[realStart - 1] !== '\n';
                    const prefix = needsPrefix ? '\n' : '';
                    
                    if (!selectedText.trim()) {
                        // ç©ºç™½è¡Œã®å ´åˆ
                        newText = prefix + 'ï¼ˆC';
                    } else {
                        // ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹å ´åˆ
                        newText = prefix + selectedText + 'ï¼ˆC';
                    }
                    break;
                case 'alt':
                    // ALTã¯ç›´å‰ã«æ”¹è¡Œã‚’å…¥ã‚Œã‚‹
                    const needsPrefixAlt = realStart > 0 && editor.value[realStart - 1] !== '\n';
                    const prefixAlt = needsPrefixAlt ? '\n' : '';
                    
                    if (!selectedText.trim()) {
                        // ç©ºç™½è¡Œã®å ´åˆ
                        newText = prefixAlt + 'ï¼ˆALT';
                    } else {
                        // ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹å ´åˆ
                        newText = prefixAlt + selectedText + 'ï¼ˆALT';
                    }
                    break;
                case 'paragraph':
                    // è¡Œã®å‰å¾Œã«ç©ºè¡Œã‚’è¿½åŠ ã—ã¦æ®µè½ã¨ã—ã¦æ‰±ã†
                    newText = '\n' + selectedText + '\n';
                    break;
            }

            editor.value = beforeText + newText + afterText;
            
            // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’èª¿æ•´
            const newPosition = realStart + newText.length;
            editor.setSelectionRange(newPosition, newPosition);
            editor.focus();
            
            updatePreview();
        }

        function insertHR() {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const beforeText = editor.value.substring(0, start);
            const afterText = editor.value.substring(end);
            
            editor.value = beforeText + '---' + afterText;
            const newPosition = start + 3;
            editor.setSelectionRange(newPosition, newPosition);
            editor.focus();
            updatePreview();
        }

        function updatePreview() {
            const text = editor.value;
            const result = convertToHTML(text);
            // å…ˆé ­ã¨æœ«å°¾ã®æ”¹è¡Œã‚’å‰Šé™¤
            htmlPreview.value = result.html.trim();
            titlePreview.value = result.title;
        }

        function convertToHTML(text) {
            if (!text.trim()) return { html: '', title: '' };

            let title = '';

            // YouTubeåŸ‹ã‚è¾¼ã¿ï¼ˆæœ€å„ªå…ˆã§å‡¦ç†ï¼‰
            text = text.replace(/https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)(?:[^\s]*)?/g, (match, videoId) => {
                return `<iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`;
            });
            
            text = text.replace(/https?:\/\/(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]+)(?:[^\s]*)?/g, (match, videoId) => {
                return `<iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`;
            });

            let lines = text.split('\n');
            let html = '';
            let inList = false;
            let listType = '';
            let paragraphBuffer = [];

            function flushParagraph() {
                if (paragraphBuffer.length > 0) {
                    const content = paragraphBuffer.join('<br>');
                    html += '<p>' + processInlineFormatting(content) + '</p>\n';
                    paragraphBuffer = [];
                }
            }

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];

                // ç©ºè¡Œ - æ®µè½ã‚’åŒºåˆ‡ã‚‹
                if (line.trim() === '') {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += '\n';
                    continue;
                }

                // æ°´å¹³ç·š
                if (line.trim() === '---') {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += '<hr>\n';
                    continue;
                }

                // è¦‹å‡ºã—ï¼ˆH1ã¯ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦æŠ½å‡ºã€HTMLã«ã¯å«ã‚ãªã„ï¼‰
                if (line.startsWith('# ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    const h1Text = line.substring(2);
                    title = h1Text; // ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦ä¿å­˜ï¼ˆHTMLã«ã¯å«ã‚ãªã„ï¼‰
                    continue;
                }
                if (line.startsWith('### ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    html += '<h3>' + line.substring(4) + '</h3>\n';
                    continue;
                }
                if (line.startsWith('## ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    html += '<h2>' + line.substring(3) + '</h2>\n';
                    continue;
                }

                // ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆ
                if (line.match(/^[-*]\s/)) {
                    flushParagraph();
                    if (!inList || listType !== 'ul') {
                        if (inList && listType === 'ol') html += '</ol>\n';
                        html += '<ul>\n';
                        inList = true;
                        listType = 'ul';
                    }
                    html += '  <li>' + processInlineFormatting(line.substring(2)) + '</li>\n';
                    continue;
                }

                // ç•ªå·ä»˜ããƒªã‚¹ãƒˆ
                if (line.match(/^\d+\.\s/)) {
                    flushParagraph();
                    if (!inList || listType !== 'ol') {
                        if (inList && listType === 'ul') html += '</ul>\n';
                        html += '<ol>\n';
                        inList = true;
                        listType = 'ol';
                    }
                    html += '  <li>' + processInlineFormatting(line.replace(/^\d+\.\s/, '')) + '</li>\n';
                    continue;
                }

                // â˜…ç”»åƒãƒãƒ¼ã‚«ãƒ¼
                if (line.startsWith('â˜…ç”»åƒ')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += 'â˜…ç”»åƒ\n';
                    continue;
                }

                // ï¼ˆCãƒãƒ¼ã‚«ãƒ¼ï¼ˆã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã®ã¿ï¼‰ â†’ <p>â˜…</p>
                if (line.trim() === 'ï¼ˆC' || line.trim() === 'ï¼ˆc') {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += '<p>â˜…</p>\n';
                    continue;
                }

                // ï¼ˆALTãƒãƒ¼ã‚«ãƒ¼ï¼ˆALTã®ã¿ï¼‰ â†’ ALTï¼‰
                if (line.trim() === 'ï¼ˆALT' || line.trim() === 'ï¼ˆalt') {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += 'ALTï¼‰\n';
                    continue;
                }

                // ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³å‡¦ç†ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼ˆC â†’ <p>ãƒ†ã‚­ã‚¹ãƒˆ</p>ï¼‰
                const captionMatch = line.match(/(.+?)ï¼ˆ[Cc]$/);
                if (captionMatch) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += '<p>' + processInlineFormatting(captionMatch[1]) + '</p>\n';
                    continue;
                }

                // ALTå‡¦ç†ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼ˆALT â†’ ALTï¼‰ãƒ†ã‚­ã‚¹ãƒˆï¼‰
                const altMatch = line.match(/(.+?)ï¼ˆ(?:ALT|alt)$/);
                if (altMatch) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += 'ALTï¼‰' + processInlineFormatting(altMatch[1]) + '\n';
                    continue;
                }

                // YouTubeåŸ‹ã‚è¾¼ã¿ï¼ˆiframeï¼‰ãŒå«ã¾ã‚Œã‚‹è¡Œ
                if (line.includes('<iframe')) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += line + '\n';
                    continue;
                }

                // URLå˜ç‹¬è¡Œ
                const urlOnlyMatch = line.trim().match(/^(https?:\/\/[^\s]+)$/);
                if (urlOnlyMatch) {
                    flushParagraph();
                    if (inList) {
                        html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                        inList = false;
                    }
                    html += '<p><a href="' + urlOnlyMatch[1] + '" target="_blank">' + urlOnlyMatch[1] + '</a></p>\n';
                    continue;
                }

                // é€šå¸¸ã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ®µè½ãƒãƒƒãƒ•ã‚¡ã«è¿½åŠ ï¼‰
                if (inList) {
                    html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
                    inList = false;
                }
                paragraphBuffer.push(line);
            }

            // æœ€å¾Œã®æ®µè½ã‚’ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
            flushParagraph();

            // ãƒªã‚¹ãƒˆãŒé–‹ã„ãŸã¾ã¾ã®å ´åˆã¯é–‰ã˜ã‚‹
            if (inList) {
                html += listType === 'ul' ? '</ul>\n' : '</ol>\n';
            }

            return { html: html, title: title };
        }
        function processInlineFormatting(text) {
            // å¤ªå­—
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            // URLè‡ªå‹•ãƒªãƒ³ã‚¯ï¼ˆYouTubeä»¥å¤–ï¼‰
            text = text.replace(/(https?:\/\/(?!(?:www\.)?(?:youtube\.com|youtu\.be))[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
            return text;
        }

        function deleteLine() {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            
            // ãƒ†ã‚­ã‚¹ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é¸æŠéƒ¨åˆ†ã®ã¿å‰Šé™¤
            if (start !== end) {
                const beforeText = editor.value.substring(0, start);
                const afterText = editor.value.substring(end);
                editor.value = beforeText + afterText;
                editor.setSelectionRange(start, start);
                editor.focus();
                updatePreview();
                return;
            }
            
            // é¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚«ãƒ¼ã‚½ãƒ«ãŒã‚ã‚‹è¡Œå…¨ä½“ã‚’å‰Šé™¤
            const text = editor.value;
            let lineStart = start;
            let lineEnd = end;
            
            // è¡Œã®é–‹å§‹ä½ç½®ã‚’æ¢ã™
            while (lineStart > 0 && text[lineStart - 1] !== '\n') {
                lineStart--;
            }
            
            // è¡Œã®çµ‚äº†ä½ç½®ã‚’æ¢ã™ï¼ˆæ”¹è¡Œã‚‚å«ã‚ã‚‹ï¼‰
            while (lineEnd < text.length && text[lineEnd] !== '\n') {
                lineEnd++;
            }
            if (lineEnd < text.length) {
                lineEnd++; // æ”¹è¡Œæ–‡å­—ã‚‚å‰Šé™¤
            }
            
            const beforeText = text.substring(0, lineStart);
            const afterText = text.substring(lineEnd);
            editor.value = beforeText + afterText;
            
            // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’èª¿æ•´
            editor.setSelectionRange(lineStart, lineStart);
            editor.focus();
            updatePreview();
        }

        function insertLineBreak() {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const beforeText = editor.value.substring(0, start);
            const afterText = editor.value.substring(end);
            
            editor.value = beforeText + '\n' + afterText;
            const newPosition = start + 1;
            editor.setSelectionRange(newPosition, newPosition);
            editor.focus();
            updatePreview();
        }

        function copyHTML(e) {
            e.preventDefault();
            const html = htmlPreview.value;
            if (!html.trim()) {
                alert('HTMLã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            htmlPreview.select();
            try {
                document.execCommand('copy');
                const button = e.currentTarget;
                const originalText = button.textContent;
                button.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Copy error:', err);
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function copyTitle(e) {
            e.preventDefault();
            const title = titlePreview.value;
            if (!title.trim()) {
                alert('ã‚¿ã‚¤ãƒˆãƒ«ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            titlePreview.select();
            try {
                document.execCommand('copy');
                const button = e.currentTarget;
                const originalText = button.textContent;
                button.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Copy error:', err);
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function toggleGuide() {
            const guideSection = document.getElementById('guideSection');
            guideSection.classList.toggle('active');
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.addEventListener('click', function(e) {
            const guideSection = document.getElementById('guideSection');
            const guideToggle = document.querySelector('.guide-toggle');
            
            // ã‚¬ã‚¤ãƒ‰ãŒé–‹ã„ã¦ã„ã¦ã€ã‚¯ãƒªãƒƒã‚¯ãŒã‚¬ã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‹ã¤ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³å¤–ã®å ´åˆ
            if (guideSection.classList.contains('active') && 
                !guideSection.contains(e.target) && 
                !guideToggle.contains(e.target)) {
                guideSection.classList.remove('active');
            }
        });

        function resetAll() {
            editor.value = '';
            updatePreview();
            editor.focus();
        }

        // åˆæœŸåŒ–
        updatePreview();
    </script>
</body>
</html>
